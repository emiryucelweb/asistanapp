import{c as e,r as a,a as t,l as s,u as r,j as l,t as n,h as i,K as d,f as o,m as c,$ as h,A as m,X as u,a0 as g,q as x,P as p,a1 as b,p as f,a2 as y,a3 as w,a4 as C,O as j,a5 as v,b as k}from"./index-ByjBXa3D.js";import{A as N}from"./arrow-left-nnZ_PHnP.js";import{P as S}from"./plus-CA_GaOao.js";import{L as M}from"./lock-C3MvTkQl.js";import{P as I}from"./paperclip-vWExmAsw.js";import{I as T}from"./image-Dcf-p8tR.js";import{V as R}from"./video-BVZ4dD6L.js";import{S as E}from"./smile-8WlDpO5i.js";import{b as D}from"./formatters-zG5fMVnG.js";
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),U=e("video-off",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function O(e){var a;const{t:s}=t("admin"),{user:u,notifications:g,showNotifications:x,showUserMenu:p,setShowNotifications:b,setShowUserMenu:f,setShowSearchModal:y,onNotificationClick:w}=e,C=r();return l.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 px-3 sm:px-4 py-2 sm:py-3 flex-shrink-0",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[l.jsx("button",{onClick:()=>C(-1),className:"p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("team.header.back"),type:"button",children:l.jsx(N,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx(n,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 dark:text-purple-400","aria-hidden":"true"}),l.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:s("teamChat.header.title")})]})]}),l.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[l.jsx("button",{onClick:()=>y(!0),className:"p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("team.header.search"),type:"button",children:l.jsx(i,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>b(!x),className:"relative p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("team.header.notifications"),"aria-expanded":x,type:"button",children:[l.jsx(d,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"}),g.filter(e=>e.unread).length>0&&l.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full","aria-label":s("teamChat.header.unreadNotifications",{count:g.filter(e=>e.unread).length})})]}),x&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>b(!1),"aria-hidden":"true"}),l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 max-h-96 overflow-y-auto",role:"menu","aria-label":s("teamChat.header.notificationsAria"),children:[l.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:l.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s("teamChat.header.notifications")})}),l.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:0===g.length?l.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400 text-sm",children:s("teamChat.header.noNotifications")}):g.map(e=>l.jsxs("button",{onClick:()=>{return a=e,b(!1),void(w&&w(a));var a},className:"w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors "+(e.unread?"bg-blue-50 dark:bg-blue-900/10":""),role:"menuitem",type:"button",children:[l.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:e.message}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.time})]},e.id))})]})]})]}),l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>f(!p),className:"flex items-center gap-1.5 sm:gap-2 p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("team.header.userMenu"),"aria-expanded":p,type:"button",children:[l.jsx("img",{src:(null==(a=null==u?void 0:u.profile)?void 0:a.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=user",alt:(null==u?void 0:u.name)||"User",className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full"}),l.jsx(o,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400","aria-hidden":"true"})]}),p&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>f(!1),"aria-hidden":"true"}),l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 overflow-hidden",role:"menu","aria-label":s("team.header.userMenu"),children:[l.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:[l.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:null==u?void 0:u.name}),l.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:null==u?void 0:u.email})]}),l.jsxs("div",{className:"p-2",children:[l.jsxs("button",{onClick:()=>{f(!1),C("agent"===(null==u?void 0:u.role)?"/agent/profile":"/admin/settings")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded text-sm text-gray-900 dark:text-gray-100 transition-colors",role:"menuitem",type:"button",children:[l.jsx(c,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("teamChat.header.myProfile")})]}),l.jsxs("button",{onClick:()=>{f(!1),C("agent"===(null==u?void 0:u.role)?"/agent/settings":"/admin/settings")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded text-sm text-gray-900 dark:text-gray-100 transition-colors",role:"menuitem",type:"button",children:[l.jsx(h,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("teamChat.header.settings")})]}),l.jsx("div",{className:"border-t border-gray-200 dark:border-slate-600 my-1"}),l.jsxs("button",{onClick:()=>{f(!1),confirm(s("teamChat.header.confirmLogout"))&&C("agent"===(null==u?void 0:u.role)?"/agent/login":"/admin/login")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded text-sm text-red-600 dark:text-red-400 transition-colors",role:"menuitem",type:"button",children:[l.jsx(m,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("team.chat.logout")})]})]})]})]})]})]})]})})}function L(e){const{t:a}=t("admin"),{channels:s,selectedChannel:r,searchQuery:d,canManageChannels:o,setSearchQuery:c,setShowCreateChannelModal:h,setShowNewDMModal:m,onChannelSelect:u}=e,g=e=>{if(!d.trim())return e;const a=d.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(a))},x=g(s.filter(e=>"direct"!==e.type)),p=g(s.filter(e=>"direct"===e.type)),b=e=>[...e].sort((e,a)=>e.isPinned&&!a.isPinned?-1:!e.isPinned&&a.isPinned?1:e.name.localeCompare(a.name)),f=e=>{var t;return"direct"===e.type?l.jsx("img",{src:(null==(t=e.metadata)?void 0:t.avatar)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e.id}`,alt:e.name,className:"w-5 h-5 rounded flex-shrink-0"}):"private"===e.type?l.jsx(M,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 flex-shrink-0","aria-label":a("teamChat.sidebar.privateChannel")}):l.jsx(P,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 flex-shrink-0","aria-label":a("teamChat.sidebar.publicChannel")})},y=e=>{const t=(null==r?void 0:r.id)===e.id,s=(e.unreadCount||0)>0;return l.jsxs("button",{onClick:()=>u(e),className:"w-full flex items-center justify-between gap-2 px-2 py-1.5 rounded text-sm mb-1 transition-colors "+(t?"bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-700 dark:text-gray-300"),"aria-label":`${e.name}${s?`, ${a("teamChat.sidebar.unreadMessages",{count:e.unreadCount})}`:""}`,"aria-current":t?"page":void 0,type:"button",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[f(e),l.jsx("span",{className:"truncate "+(s?"font-semibold":""),children:e.name})]}),s&&l.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 bg-purple-600 dark:bg-purple-500 text-white text-xs rounded-full min-w-[20px] text-center","aria-label":a("teamChat.sidebar.unread",{count:e.unreadCount}),children:e.unreadCount>99?"99+":e.unreadCount})]},e.id)};return l.jsxs("div",{className:"hidden md:flex md:w-64 lg:w-72 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 flex-col",children:[l.jsxs("div",{className:"p-3 sm:p-4 border-b border-gray-200 dark:border-slate-700",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("h2",{className:"font-semibold text-gray-900 dark:text-white",children:a("teamChat.sidebar.channels")}),o&&l.jsx("button",{onClick:()=>h(!0),className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":a("teamChat.sidebar.createChannel"),title:a("teamChat.sidebar.createChannelAdmin"),type:"button",children:l.jsx(S,{className:"w-4 h-4 text-gray-600 dark:text-gray-400","aria-hidden":"true"})})]}),l.jsxs("div",{className:"relative",children:[l.jsx(i,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),l.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:a("teamChat.sidebar.searchChannels"),className:"w-full pl-8 pr-3 py-1.5 text-sm bg-gray-100 dark:bg-slate-700 border-0 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400","aria-label":a("teamChat.sidebar.searchChannelsAria")})]})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"flex items-center justify-between px-2 mb-2",children:[l.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("teamChat.sidebar.channelsSection")}),x.length>0&&l.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:x.length})]}),b(x).map(y),0===x.length&&l.jsx("p",{className:"px-2 py-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:a(d?"teamChat.sidebar.noChannelsFound":"teamChat.sidebar.noChannelsYet")})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between px-2 mb-2",children:[l.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("teamChat.sidebar.directMessages")}),l.jsx("button",{onClick:()=>m(!0),className:"p-0.5 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":a("teamChat.sidebar.newDirectMessage"),type:"button",children:l.jsx(S,{className:"w-3.5 h-3.5 text-gray-500 dark:text-gray-400","aria-hidden":"true"})})]}),b(p).map(y),0===p.length&&l.jsx("p",{className:"px-2 py-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:a(d?"teamChat.sidebar.noUsersFound":"teamChat.sidebar.noDirectMessagesYet")})]})]}),l.jsx("div",{className:"p-3 border-t border-gray-200 dark:border-slate-700",children:l.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400",children:[l.jsx(n,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:a("teamChat.sidebar.channelCount",{count:s.length})})]})})]})}function F(e){const{t:s}=t("admin"),{messageInput:r,isSending:n,replyingTo:i,showAttachMenu:d,showEmojiPicker:o,showMentionMenu:c,fileInputRef:h,imageInputRef:m,videoInputRef:p,setMessageInput:b,setReplyingTo:f,setShowAttachMenu:y,setShowEmojiPicker:w,setShowMentionMenu:C,onSendMessage:j,onFileUpload:v}=e,k=a.useRef(null);a.useEffect(()=>{const e=k.current;if(!e)return;e.style.height="auto";const a=Math.min(e.scrollHeight,200);e.style.height=`${a}px`},[r]),a.useEffect(()=>{var e;null==(e=k.current)||e.focus()},[]);const N=(e,a)=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&(v(s,a),e.target.value="")},S=!r.trim()||n;return l.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-3 sm:p-4",children:[i&&l.jsxs("div",{className:"mb-2 p-2 bg-gray-100 dark:bg-slate-700 rounded-lg flex items-start justify-between gap-2",children:[l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx("span",{className:"text-xs font-medium text-purple-600 dark:text-purple-400",children:s("teamChat.input.replyingTo")}),l.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:s("teamChat.input.user",{userId:i.userId})})]}),l.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-1",children:i.content})]}),l.jsx("button",{onClick:()=>f(null),className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-600 rounded transition-colors flex-shrink-0","aria-label":s("teamChat.input.cancelReply"),type:"button",children:l.jsx(u,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"})})]}),l.jsxs("div",{className:"flex items-end gap-2",children:[l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsxs("div",{className:"relative",children:[l.jsx("button",{onClick:()=>y(!d),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("team.chat.addFile"),"aria-expanded":d,disabled:n,type:"button",children:l.jsx(I,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),d&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1),"aria-hidden":"true"}),l.jsxs("div",{className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 overflow-hidden",role:"menu","aria-label":s("team.chat.fileOptions"),children:[l.jsxs("button",{onClick:()=>{var e;null==(e=m.current)||e.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[l.jsx(T,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("teamChat.input.image")})]}),l.jsxs("button",{onClick:()=>{var e;null==(e=p.current)||e.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[l.jsx(R,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("teamChat.input.video")})]}),l.jsxs("button",{onClick:()=>{var e;null==(e=h.current)||e.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[l.jsx(I,{className:"w-4 h-4","aria-hidden":"true"}),l.jsx("span",{children:s("teamChat.input.file")})]})]})]})]}),l.jsx("button",{onClick:()=>w(!o),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("teamChat.input.addEmoji"),"aria-expanded":o,disabled:n,type:"button",children:l.jsx(E,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),l.jsx("button",{onClick:()=>C(!c),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":s("teamChat.input.mentionUser"),"aria-expanded":c,disabled:n,type:"button",children:l.jsx(g,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})})]}),l.jsx("div",{className:"flex-1 min-w-0",children:l.jsx("textarea",{ref:k,value:r,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j()),"@"===e.key&&C(!0)},placeholder:s("teamChat.input.messagePlaceholder"),disabled:n,rows:1,className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none transition-colors","aria-label":s("teamChat.input.typeMessage"),style:{minHeight:"40px",maxHeight:"200px"}})}),l.jsx("button",{onClick:j,disabled:S,className:"p-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 dark:disabled:bg-slate-700 text-white rounded-lg transition-colors flex-shrink-0 disabled:cursor-not-allowed","aria-label":s("teamChat.input.send"),type:"button",children:l.jsx(x,{className:"w-5 h-5 "+(n?"animate-pulse":""),"aria-hidden":"true"})})]}),r.length>900&&l.jsx("div",{className:"mt-1 text-right",children:l.jsxs("span",{className:"text-xs "+(r.length>1e3?"text-red-600 dark:text-red-400 font-semibold":"text-gray-500 dark:text-gray-400"),children:[r.length,"/1000"]})}),l.jsx("input",{ref:h,type:"file",accept:"*/*",onChange:e=>N(e,"file"),className:"hidden","aria-hidden":"true"}),l.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:e=>N(e,"image"),className:"hidden","aria-hidden":"true"}),l.jsx("input",{ref:p,type:"file",accept:"video/*",onChange:e=>N(e,"video"),className:"hidden","aria-hidden":"true"})]})}function A(e){const{t:a}=t("admin"),{callType:s,callStatus:r,selectedChannel:n,callDuration:i,isMicMuted:d,isVideoOff:o,isSpeakerMuted:c,setIsMicMuted:h,setIsVideoOff:m,setIsSpeakerMuted:u,setCallStatus:g,setShowCallModal:x}=e;return l.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-purple-900/95 to-blue-900/95 flex items-center justify-center z-50 p-4 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"call-modal-title","aria-describedby":"call-modal-description",children:l.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full border border-white/20 shadow-2xl",children:l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:`w-28 h-28 mx-auto mb-6 rounded-full flex items-center justify-center relative ${(()=>{switch(r){case"calling":return"bg-blue-500/30 animate-pulse";case"connected":return"bg-green-500/30";case"ended":return"bg-red-500/30";default:return"bg-blue-500/30"}})()}`,children:["voice"===s?l.jsx(p,{className:"w-14 h-14 text-white","aria-hidden":"true"}):l.jsx(R,{className:"w-14 h-14 text-white","aria-hidden":"true"}),"connected"===r&&l.jsx("div",{className:"absolute -bottom-2 -right-2 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center border-4 border-white/10","aria-label":a("team.connected"),children:l.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"})})]}),l.jsx("h3",{id:"call-modal-title",className:"text-2xl font-bold text-white mb-2",children:(null==n?void 0:n.name)||a("teamChat.modals.call.unknown")}),l.jsx("p",{id:"call-modal-description",className:"text-white/70 text-lg mb-8","aria-live":"polite","aria-atomic":"true",children:(()=>{switch(r){case"calling":return a("team.modals.call.calling");case"connected":return function(e){const a=Math.floor(e/60),t=e%60;return`${String(a).padStart(2,"0")}:${String(t).padStart(2,"0")}`}(i);case"ended":return a("team.modals.call.callEnded");default:return""}})()}),"ended"!==r&&l.jsxs("div",{className:"flex gap-4 justify-center mb-6",role:"group","aria-label":a("team.callControls"),children:[l.jsx("button",{onClick:()=>h(!d),className:"p-4 rounded-full transition-all "+(d?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"),"aria-label":a(d?"team.modals.call.micUnmute":"team.modals.call.micMute"),"aria-pressed":d,type:"button",children:d?l.jsx(b,{className:"w-6 h-6 text-white","aria-hidden":"true"}):l.jsx(f,{className:"w-6 h-6 text-white","aria-hidden":"true"})}),"video"===s&&l.jsx("button",{onClick:()=>m(!o),className:"p-4 rounded-full transition-all "+(o?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"),"aria-label":a(o?"team.modals.call.videoOn":"team.modals.call.videoOff"),"aria-pressed":o,type:"button",children:o?l.jsx(U,{className:"w-6 h-6 text-white","aria-hidden":"true"}):l.jsx(R,{className:"w-6 h-6 text-white","aria-hidden":"true"})}),l.jsx("button",{onClick:()=>u(!c),className:"p-4 rounded-full transition-all "+(c?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"),"aria-label":a(c?"team.modals.call.speakerUnmute":"team.modals.call.speakerMute"),"aria-pressed":c,type:"button",children:c?l.jsx(y,{className:"w-6 h-6 text-white","aria-hidden":"true"}):l.jsx(w,{className:"w-6 h-6 text-white","aria-hidden":"true"})})]}),l.jsxs("button",{onClick:()=>{g("ended"),setTimeout(()=>{x(null)},1e3)},className:"w-full px-6 py-4 bg-red-500 hover:bg-red-600 text-white rounded-2xl font-semibold flex items-center justify-center gap-3 transition-all shadow-lg hover:shadow-xl transform hover:scale-105","aria-label":a("team.endCall"),type:"button",children:[l.jsx(C,{className:"w-6 h-6","aria-hidden":"true"}),a("teamChat.modals.call.endCall")]})]})})})}function V(e){const{t:r}=t("admin"),{onCreateChannel:n,onClose:i,isSubmitting:d=!1}=e,[o,c]=a.useState(""),[h,m]=a.useState(""),[g,x]=a.useState(!1),[p,b]=a.useState("all"),[f,y]=a.useState([]),[w,C]=a.useState(""),j=a.useRef(null);a.useEffect(()=>{var e;null==(e=j.current)||e.focus()},[]);return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&i()},role:"dialog","aria-modal":"true","aria-labelledby":"create-channel-modal-title",children:l.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full shadow-2xl",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{id:"create-channel-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white",children:r("teamChat.modals.createChannel.title")}),l.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":r("settings.team.channelModal.close"),type:"button",disabled:d,children:l.jsx(u,{className:"w-5 h-5","aria-hidden":"true"})})]}),l.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=(t=o).trim()?t.length<3?r("team.modals.createChannel.validation.nameMinLength"):t.length>50?r("team.modals.createChannel.validation.nameMaxLength"):/^[a-zA-Z0-9-_\s]+$/.test(t)?null:r("team.modals.createChannel.validation.nameInvalidChars"):r("team.modals.createChannel.validation.nameRequired");var t;if(a)return C(a),void s.warn("[CreateChannelModal] Validation failed",{error:a,channelName:o});const l={name:o,description:h.trim(),isPrivate:g,memberSelection:p,selectedMembers:"specific"===p?f:void 0};s.info("[CreateChannelModal] Channel creation requested",{formData:l}),n(l)},className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{htmlFor:"team-channel-name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("teamChat.modals.createChannel.channelName")," ",l.jsx("span",{className:"text-red-500","aria-label":r("settings.team.channelModal.required"),children:"*"})]}),l.jsx("input",{ref:j,id:"team-channel-name",type:"text",value:o,onChange:e=>(e=>{const a=e.replace(/\s+/g,"-").toLowerCase();c(a),w&&C("")})(e.target.value),placeholder:r("settings.team.channelModal.channelSlugPlaceholder"),className:"w-full px-3 py-2 border rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors "+(w?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-slate-600"),"aria-invalid":!!w,"aria-describedby":w?"name-error":"name-help",disabled:d,required:!0}),w?l.jsx("p",{id:"name-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:w}):l.jsx("p",{id:"name-help",className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r("teamChat.modals.createChannel.spacesHelp")})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"team-channel-description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("team.modals.createChannel.descriptionOptional")}),l.jsx("textarea",{id:"team-channel-description",value:h,onChange:e=>m(e.target.value),placeholder:r("settings.team.channelModal.descriptionPlaceholder"),rows:3,maxLength:200,className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none","aria-describedby":"description-counter",disabled:d}),l.jsxs("p",{id:"description-counter",className:"mt-1 text-xs text-gray-500 dark:text-gray-400 text-right",children:[h.length,"/200"]})]}),l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("input",{type:"checkbox",id:"private-channel",checked:g,onChange:e=>x(e.target.checked),className:"mt-0.5 rounded border-gray-300 text-purple-600 focus:ring-purple-500",disabled:d}),l.jsxs("div",{className:"flex-1",children:[l.jsx("label",{htmlFor:"private-channel",className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer",children:r("teamChat.modals.createChannel.makePrivate")}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:r("teamChat.modals.createChannel.privateHelp")})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("teamChat.modals.createChannel.members")}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",name:"member-selection",value:"all",checked:"all"===p,onChange:()=>b("all"),className:"text-purple-600 focus:ring-purple-500",disabled:d}),l.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r("teamChat.modals.createChannel.allTeam")})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",name:"member-selection",value:"specific",checked:"specific"===p,onChange:()=>b("specific"),className:"text-purple-600 focus:ring-purple-500",disabled:d}),l.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r("teamChat.modals.createChannel.specificMembers")})]})]}),"specific"===p&&l.jsx("div",{className:"mt-2 p-3 bg-gray-50 dark:bg-slate-900 rounded-lg",children:l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("teamChat.modals.createChannel.specificMembersHelp")})})]}),l.jsxs("div",{className:"flex gap-2 pt-2",children:[l.jsx("button",{type:"submit",disabled:d||!o.trim(),className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-purple-500 focus:ring-offset-2",children:d?r("team.modals.createChannel.creating")||"Creating...":r("team.modals.createChannel.create")||"Create"}),l.jsx("button",{type:"button",onClick:i,disabled:d,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r("common:cancel")})]})]})]})})}function z(e){const{t:a}=t("admin"),{messageId:s,onConfirm:r,onCancel:n,title:i=a("team.deleteMessage"),description:d=a("team.deleteMessageConfirm"),confirmText:o=a("common.delete"),cancelText:c=a("common.cancel")}=e;return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&n()},role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:l.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-sm w-full shadow-2xl transform transition-all",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 mx-auto bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-4","aria-hidden":"true",children:l.jsx(j,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),l.jsx("h3",{id:"delete-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:i}),l.jsx("p",{id:"delete-modal-description",className:"text-gray-600 dark:text-gray-400 mb-6",children:d}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:n,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors font-medium",type:"button",autoFocus:!0,children:c}),l.jsx("button",{onClick:()=>{r(s)},className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium focus:ring-2 focus:ring-red-500 focus:ring-offset-2",type:"button",children:o})]})]})})})}function Q(e){try{return D(e)}catch(a){return s.error("[TeamChat] Error formatting time",a),"--:--"}}function $(e){if(!e||"string"!=typeof e)return s.warn("[TeamChat] Invalid avatar seed",new Error(`Invalid seed: ${e}`)),"https://api.dicebear.com/7.x/avataaars/svg?seed=default";return`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(e)}`}function K(e){const{t:s}=t("admin"),{messages:r,searchQuery:n,setSearchQuery:d,onClose:o,onMessageClick:c}=e,h=a.useRef(null);a.useEffect(()=>{var e;null==(e=h.current)||e.focus()},[]);const m=n.trim()?r.filter(e=>e.content.toLowerCase().includes(n.toLowerCase())):[];return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&o()},role:"dialog","aria-modal":"true","aria-labelledby":"search-modal-title",children:l.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-2xl w-full max-h-[80vh] flex flex-col shadow-2xl",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[l.jsx("h3",{id:"search-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white",children:s("teamChat.modals.search.title")}),l.jsx("button",{onClick:o,className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":s("reports.close"),type:"button",children:l.jsx(u,{className:"w-5 h-5","aria-hidden":"true"})})]}),l.jsx("div",{className:"mb-4 flex-shrink-0",children:l.jsxs("div",{className:"relative",children:[l.jsx(i,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","aria-hidden":"true"}),l.jsx("input",{ref:h,type:"text",value:n,onChange:e=>d(e.target.value),placeholder:s("team.searchMessages"),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent placeholder:text-gray-500 dark:placeholder:text-gray-400","aria-label":s("team.searchQuery")})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:n.trim()?m.length>0?l.jsx("div",{className:"space-y-2",role:"list","aria-label":s("team.searchResults"),children:m.map(e=>l.jsx("button",{onClick:()=>{return a=e.id,c(a),void o();var a},className:"w-full p-3 text-left hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors",type:"button",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("img",{src:$(e.userId),alt:s("teamChat.messages.userAvatar"),className:"w-8 h-8 rounded flex-shrink-0"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[l.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:s("teamChat.modals.search.user",{userId:e.userId})}),l.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Q(e.timestamp)})]}),l.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2",children:e.content})]})]})},e.id))}):l.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-12",children:[l.jsx(i,{className:"w-12 h-12 mx-auto mb-2 opacity-50","aria-hidden":"true"}),l.jsx("p",{className:"font-medium",children:s("teamChat.modals.search.noResults")}),l.jsx("p",{className:"text-sm mt-1",children:s("teamChat.modals.search.noResultsFor",{query:n})})]}):l.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-12",children:[l.jsx(i,{className:"w-12 h-12 mx-auto mb-2 opacity-50","aria-hidden":"true"}),l.jsx("p",{className:"font-medium",children:s("teamChat.modals.search.typeToSearch")}),l.jsx("p",{className:"text-sm mt-1",children:s("teamChat.modals.search.searchInContent")})]})}),n.trim()&&m.length>0&&l.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-slate-700 flex-shrink-0",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:s("teamChat.modals.search.resultsFound",{count:m.length})})})]})})}const H=()=>{const{t:e}=t("admin"),r=v(),{user:n}=k(),i=function(){const[e,t]=a.useState([]),[s,r]=a.useState(null),[l,n]=a.useState([]),[i,d]=a.useState([]),[o,c]=a.useState(""),[h,m]=a.useState(""),[u,g]=a.useState(""),[x,p]=a.useState(""),[b,f]=a.useState(!1),[y,w]=a.useState(!1),[C,j]=a.useState(!1),[v,k]=a.useState(!1),[N,S]=a.useState(!1),[M,I]=a.useState(!1),[T,R]=a.useState(!1),[E,D]=a.useState(!1),[P,U]=a.useState(!1),[O,L]=a.useState(!1),[F,A]=a.useState(!1),[V,z]=a.useState(!1),[Q,$]=a.useState(null),[K,H]=a.useState(null),[B,q]=a.useState(null),[W,Y]=a.useState(null),[Z,_]=a.useState(null),[G,J]=a.useState(null),[X,ee]=a.useState([]),[ae,te]=a.useState([]),[se,re]=a.useState(!1),[le,ne]=a.useState(null),[ie,de]=a.useState("calling"),[oe,ce]=a.useState(0),[he,me]=a.useState(!1),[ue,ge]=a.useState(!1),[xe,pe]=a.useState(!1);return{channels:e,setChannels:t,selectedChannel:s,setSelectedChannel:r,messages:l,setMessages:n,notifications:i,setNotifications:d,messageInput:o,setMessageInput:c,channelSearchQuery:h,setChannelSearchQuery:m,messageSearchQuery:u,setMessageSearchQuery:g,editingContent:x,setEditingContent:p,showNotifications:b,setShowNotifications:f,showUserMenu:y,setShowUserMenu:w,showSearchModal:C,setShowSearchModal:j,showCreateChannelModal:v,setShowCreateChannelModal:k,showMembersSidebar:N,setShowMembersSidebar:S,showChannelInfoModal:M,setShowChannelInfoModal:I,showNewDMModal:T,setShowNewDMModal:R,showThreadSidebar:E,setShowThreadSidebar:D,showAttachMenu:P,setShowAttachMenu:U,showEmojiPicker:O,setShowEmojiPicker:L,showMentionMenu:F,setShowMentionMenu:A,showScrollButton:V,setShowScrollButton:z,showMessageActions:Q,setShowMessageActions:$,showReactionPicker:K,setShowReactionPicker:H,showDeleteConfirm:B,setShowDeleteConfirm:q,editingMessageId:W,setEditingMessageId:Y,replyingTo:Z,setReplyingTo:_,selectedThreadMessage:G,setSelectedThreadMessage:J,threadReplies:X,setThreadReplies:ee,typingUsers:ae,setTypingUsers:te,isSending:se,setIsSending:re,showCallModal:le,setShowCallModal:ne,callStatus:ie,setCallStatus:de,callDuration:oe,setCallDuration:ce,isMicMuted:he,setIsMicMuted:me,isVideoOff:ue,setIsVideoOff:ge,isSpeakerMuted:xe,setIsSpeakerMuted:pe,refs:{messagesEndRef:a.useRef(null),fileInputRef:a.useRef(null),imageInputRef:a.useRef(null),videoInputRef:a.useRef(null)}}}(),d=function(e){const{t:a}=t(),{selectedChannel:r,messageInput:l,isSending:n,replyingTo:i,setMessages:d,setMessageInput:o,setReplyingTo:c,setIsSending:h,messagesEndRef:m}=e,u=()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})};return{loadMessagesForChannel:e=>{s.debug("Loading messages for channel",{channelId:e}),d([])},handleSendMessage:async()=>{l.trim()&&r&&!n&&(h(!0),s.debug("Sending message",{channelId:r.id,content:l,replyToId:null==i?void 0:i.id}),o(""),c(null),h(!1),u())},handleFileUpload:(e,t)=>{r&&(e.size>10485760?alert(a("admin.team.fileSizeLimit")):"image"!==t||e.type.startsWith("image/")?"video"!==t||e.type.startsWith("video/")?s.debug("Uploading file",{fileName:e.name,fileSize:e.size,fileType:t}):alert(a("admin.team.invalidVideoFile")):alert(a("admin.team.invalidImageFile")))},handleReaction:(e,a)=>{s.debug("Adding reaction",{messageId:e,emoji:a}),d(t=>t.map(t=>t.id===e?{...t,reactions:[...t.reactions,{emoji:a,userId:"current-user",timestamp:(new Date).toISOString()}]}:t))},handleEditMessage:async(e,a)=>{a.trim()&&(s.debug("Editing message",{messageId:e,newContent:a}),d(t=>t.map(t=>t.id===e?{...t,content:a,isEdited:!0}:t)))},handleDeleteMessage:async e=>{s.debug("Deleting message",{messageId:e}),d(a=>a.filter(a=>a.id!==e))},handleBookmark:e=>{s.debug("Bookmarking message",{messageId:e}),d(a=>a.map(a=>a.id===e?{...a,isPinned:!a.isPinned}:a))},scrollToBottom:u}}({selectedChannel:i.selectedChannel,messageInput:i.messageInput,isSending:i.isSending,messages:i.messages,replyingTo:i.replyingTo,setMessages:i.setMessages,setMessageInput:i.setMessageInput,setReplyingTo:i.setReplyingTo,setIsSending:i.setIsSending,messagesEndRef:i.refs.messagesEndRef});!function(e){const{showCallModal:t,callStatus:r,setCallStatus:l,setCallDuration:n,setIsMicMuted:i,setIsVideoOff:d,setIsSpeakerMuted:o,onMount:c}=e;a.useEffect(()=>(s.info("[TeamChat] Component mounted - loading initial data",{timestamp:(new Date).toISOString()}),c&&c(),()=>{s.debug("[TeamChat] Component unmounting")}),[]),a.useEffect(()=>{if(t&&"connected"===r){s.debug("[TeamChat] Starting call timer",{callType:t,timestamp:(new Date).toISOString()});const e=setInterval(()=>{n(e=>{const a=e+1;return a%60==0&&s.info("[TeamChat] Call duration milestone",{minutes:a/60,callType:t}),a})},1e3);return()=>{clearInterval(e),s.debug("[TeamChat] Call timer stopped")}}},[t,r,n]),a.useEffect(()=>{if(t&&"calling"===r){s.debug("[TeamChat] Call initiated - simulating connection",{callType:t,timeout:3e3});const e=setTimeout(()=>{l("connected"),s.info("[TeamChat] Call connected",{callType:t,timestamp:(new Date).toISOString()})},3e3);return()=>{clearTimeout(e),s.debug("[TeamChat] Connection timeout cleared")}}},[t,r,l]),a.useEffect(()=>{t||(s.debug("[TeamChat] Call modal closed - resetting call state",{timestamp:(new Date).toISOString()}),l("calling"),n(0),i(!1),d(!1),o(!1))},[t,l,n,i,d,o])}({showCallModal:i.showCallModal,callStatus:i.callStatus,setCallStatus:i.setCallStatus,setCallDuration:i.setCallDuration,setIsMicMuted:i.setIsMicMuted,setIsVideoOff:i.setIsVideoOff,setIsSpeakerMuted:i.setIsSpeakerMuted,onMount:()=>{s.info("[TeamChatPage] Component mounted",{userId:null==n?void 0:n.id,userRole:null==n?void 0:n.role})}}),function(e){const{setShowSearchModal:t,setShowCreateChannelModal:r,setShowCallModal:l,setShowChannelInfoModal:n,setShowNewDMModal:i,setShowNotifications:d,setShowUserMenu:o,setShowMembersSidebar:c,enabled:h=!0}=e;a.useEffect(()=>{if(!h)return void s.debug("[TeamChat] Keyboard shortcuts disabled");const e=e=>"Escape"===e.key?(s.debug("[TeamChat] Escape key pressed - closing all modals",{timestamp:(new Date).toISOString()}),t(!1),r(!1),l(null),n(!1),i(!1),d(!1),o(!1),c(!1),void e.preventDefault()):(e.metaKey||e.ctrlKey)&&"k"===e.key?(s.debug("[TeamChat] Search shortcut triggered",{timestamp:(new Date).toISOString()}),t(!0),void e.preventDefault()):void 0;return window.addEventListener("keydown",e,{passive:!1}),s.debug("[TeamChat] Keyboard shortcuts initialized",{enabled:h,supportedKeys:["Escape","Cmd/Ctrl+K"]}),()=>{window.removeEventListener("keydown",e),s.debug("[TeamChat] Keyboard shortcuts cleaned up")}},[h,t,r,l,n,i,d,o,c])}({setShowSearchModal:i.setShowSearchModal,setShowCreateChannelModal:i.setShowCreateChannelModal,setShowCallModal:i.setShowCallModal,setShowChannelInfoModal:i.setShowChannelInfoModal,setShowNewDMModal:i.setShowNewDMModal,setShowNotifications:i.setShowNotifications,setShowUserMenu:i.setShowUserMenu,setShowMembersSidebar:i.setShowMembersSidebar,enabled:!0});const o="admin"===(null==n?void 0:n.role)||"owner"===(null==n?void 0:n.role),c=e=>{s.debug("[TeamChatPage] Channel selected",{channelId:e.id}),i.setSelectedChannel(e),d.loadMessagesForChannel(e.id),i.setShowMembersSidebar(!1)};a.useEffect(()=>{const e=new URLSearchParams(r.search),a=e.get("channelId"),t=e.get("messageId");if(a&&t){s.debug("[TeamChatPage] Handling mention notification",{channelId:a,messageId:t});const e=i.channels.find(e=>e.id===a);e?(c(e),setTimeout(()=>{const e=document.getElementById(`message-${t}`);e?(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{e.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3)):s.warn("[TeamChatPage] Message element not found",{messageId:t})},500)):s.warn("[TeamChatPage] Channel not found",{channelId:a})}},[r.search,i.channels]);return l.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 dark:bg-slate-900",children:[l.jsx(O,{user:n,notifications:i.notifications,showNotifications:i.showNotifications,showUserMenu:i.showUserMenu,setShowNotifications:i.setShowNotifications,setShowUserMenu:i.setShowUserMenu,setShowSearchModal:i.setShowSearchModal,onNotificationClick:e=>{if(s.debug("[TeamChatPage] Notification clicked",{notificationId:e.id}),e.channelId){const a=i.channels.find(a=>a.id===e.channelId);a&&c(a)}e.messageId&&setTimeout(()=>{const a=document.getElementById(`message-${e.messageId}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{a.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3))},300)}}),l.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[l.jsx(L,{channels:i.channels,selectedChannel:i.selectedChannel,searchQuery:i.channelSearchQuery,canManageChannels:o,setSearchQuery:i.setChannelSearchQuery,setShowCreateChannelModal:i.setShowCreateChannelModal,setShowNewDMModal:i.setShowNewDMModal,onChannelSelect:c}),l.jsx("div",{className:"flex-1 flex flex-col bg-white dark:bg-slate-800",children:i.selectedChannel?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===i.messages.length?l.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400",children:l.jsx("p",{children:e("teamChat.messages.noMessages")})}):l.jsxs("div",{className:"space-y-4",children:[i.messages.map(a=>l.jsxs("div",{id:`message-${a.id}`,className:"flex items-start gap-3 transition-colors duration-300",children:[l.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${a.userId}`,alt:e("teamChat.messages.userAvatar"),className:"w-10 h-10 rounded flex-shrink-0"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[l.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:e("teamChat.messages.user",{userId:a.userId})}),l.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:Q(a.timestamp)})]}),l.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:a.content})]})]},a.id)),l.jsx("div",{ref:i.refs.messagesEndRef})]})}),l.jsx(F,{messageInput:i.messageInput,isSending:i.isSending,replyingTo:i.replyingTo,showAttachMenu:i.showAttachMenu,showEmojiPicker:i.showEmojiPicker,showMentionMenu:i.showMentionMenu,fileInputRef:i.refs.fileInputRef,imageInputRef:i.refs.imageInputRef,videoInputRef:i.refs.videoInputRef,setMessageInput:i.setMessageInput,setReplyingTo:i.setReplyingTo,setShowAttachMenu:i.setShowAttachMenu,setShowEmojiPicker:i.setShowEmojiPicker,setShowMentionMenu:i.setShowMentionMenu,onSendMessage:d.handleSendMessage,onFileUpload:d.handleFileUpload})]}):l.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-lg font-medium mb-2",children:e("teamChat.selectChannel")}),l.jsx("p",{className:"text-sm",children:e("teamChat.selectChannelDescription")})]})})})]}),i.showCallModal&&l.jsx(A,{callType:i.showCallModal,callStatus:i.callStatus,selectedChannel:i.selectedChannel,callDuration:i.callDuration,isMicMuted:i.isMicMuted,isVideoOff:i.isVideoOff,isSpeakerMuted:i.isSpeakerMuted,setIsMicMuted:i.setIsMicMuted,setIsVideoOff:i.setIsVideoOff,setIsSpeakerMuted:i.setIsSpeakerMuted,setCallStatus:i.setCallStatus,setShowCallModal:i.setShowCallModal}),i.showCreateChannelModal&&l.jsx(V,{onCreateChannel:a=>{s.info("[TeamChatPage] Creating channel",{formData:a}),alert(e("teamChat.channelCreated",{name:a.name})),i.setShowCreateChannelModal(!1)},onClose:()=>i.setShowCreateChannelModal(!1),isSubmitting:!1}),i.showDeleteConfirm&&l.jsx(z,{messageId:i.showDeleteConfirm,onConfirm:d.handleDeleteMessage,onCancel:()=>i.setShowDeleteConfirm(null)}),i.showSearchModal&&l.jsx(K,{messages:i.messages,searchQuery:i.messageSearchQuery,setSearchQuery:i.setMessageSearchQuery,onClose:()=>{i.setShowSearchModal(!1),i.setMessageSearchQuery("")},onMessageClick:e=>{s.debug("[TeamChatPage] Search result clicked",{messageId:e});const a=document.getElementById(`message-${e}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{a.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3))}})]})};export{H as default};
