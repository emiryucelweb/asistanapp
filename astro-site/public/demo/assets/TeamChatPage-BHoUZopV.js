import{c as U,l as x,j as e,o as L,d as T,A as De,b as Pe,g as Ae,O as Ue,L as Le,X as D,Q as Oe,m as $e,P as Ve,V as Fe,k as Qe,W as ze,Y as Be,Z as He,G as Ke,u as qe}from"./index-C7O9AXuv.js";import{r as n}from"./vendor-CdXbigxo.js";import{u as M}from"./i18n-CvUHAAnz.js";import{a as _e,u as We}from"./router-Bk68T6VO.js";import{A as Ye}from"./arrow-left--Ig8REyU.js";import{P}from"./plus-CMVfPRMN.js";import{L as Xe}from"./lock-DSGmpsVp.js";import{P as A}from"./paperclip-DWJYrJpv.js";import{I as Ze}from"./image-yztVd6a1.js";import{V as R}from"./video-D6iK5C6-.js";import{S as Ge}from"./smile-SoFAiEFd.js";import{b as Je}from"./formatters-C0LQKFsG.js";import"./charts-CyRV38jT.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],aa=U("hash",ea);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],sa=U("video-off",ta);function ra(){const[c,t]=n.useState([]),[r,a]=n.useState(null),[i,h]=n.useState([]),[m,d]=n.useState([]),[u,p]=n.useState(""),[f,s]=n.useState(""),[g,y]=n.useState(""),[w,C]=n.useState(""),[o,j]=n.useState(!1),[N,b]=n.useState(!1),[k,v]=n.useState(!1),[l,S]=n.useState(!1),[I,E]=n.useState(!1),[$,V]=n.useState(!1),[F,Q]=n.useState(!1),[z,B]=n.useState(!1),[H,K]=n.useState(!1),[q,_]=n.useState(!1),[W,Y]=n.useState(!1),[X,Z]=n.useState(!1),[G,J]=n.useState(null),[ee,ae]=n.useState(null),[te,se]=n.useState(null),[re,le]=n.useState(null),[ne,ie]=n.useState(null),[oe,de]=n.useState(null),[ce,he]=n.useState([]),[me,ue]=n.useState([]),[ge,xe]=n.useState(!1),[pe,fe]=n.useState(null),[be,ye]=n.useState("calling"),[we,Ce]=n.useState(0),[ke,je]=n.useState(!1),[Ne,ve]=n.useState(!1),[Se,Me]=n.useState(!1),Ie=n.useRef(null),Te=n.useRef(null),Ee=n.useRef(null),Re=n.useRef(null);return{channels:c,setChannels:t,selectedChannel:r,setSelectedChannel:a,messages:i,setMessages:h,notifications:m,setNotifications:d,messageInput:u,setMessageInput:p,channelSearchQuery:f,setChannelSearchQuery:s,messageSearchQuery:g,setMessageSearchQuery:y,editingContent:w,setEditingContent:C,showNotifications:o,setShowNotifications:j,showUserMenu:N,setShowUserMenu:b,showSearchModal:k,setShowSearchModal:v,showCreateChannelModal:l,setShowCreateChannelModal:S,showMembersSidebar:I,setShowMembersSidebar:E,showChannelInfoModal:$,setShowChannelInfoModal:V,showNewDMModal:F,setShowNewDMModal:Q,showThreadSidebar:z,setShowThreadSidebar:B,showAttachMenu:H,setShowAttachMenu:K,showEmojiPicker:q,setShowEmojiPicker:_,showMentionMenu:W,setShowMentionMenu:Y,showScrollButton:X,setShowScrollButton:Z,showMessageActions:G,setShowMessageActions:J,showReactionPicker:ee,setShowReactionPicker:ae,showDeleteConfirm:te,setShowDeleteConfirm:se,editingMessageId:re,setEditingMessageId:le,replyingTo:ne,setReplyingTo:ie,selectedThreadMessage:oe,setSelectedThreadMessage:de,threadReplies:ce,setThreadReplies:he,typingUsers:me,setTypingUsers:ue,isSending:ge,setIsSending:xe,showCallModal:pe,setShowCallModal:fe,callStatus:be,setCallStatus:ye,callDuration:we,setCallDuration:Ce,isMicMuted:ke,setIsMicMuted:je,isVideoOff:Ne,setIsVideoOff:ve,isSpeakerMuted:Se,setIsSpeakerMuted:Me,refs:{messagesEndRef:Ie,fileInputRef:Te,imageInputRef:Ee,videoInputRef:Re}}}function la(c){const{t}=M(),{selectedChannel:r,messageInput:a,isSending:i,replyingTo:h,setMessages:m,setMessageInput:d,setReplyingTo:u,setIsSending:p,messagesEndRef:f}=c,s=b=>{x.debug("Loading messages for channel",{channelId:b}),m([])},g=async()=>{!a.trim()||!r||i||(p(!0),x.debug("Sending message",{channelId:r.id,content:a,replyToId:h==null?void 0:h.id}),d(""),u(null),p(!1),N())},y=(b,k)=>{if(r){if(b.size>10*1024*1024){alert(t("admin.team.fileSizeLimit"));return}if(k==="image"&&!b.type.startsWith("image/")){alert(t("admin.team.invalidImageFile"));return}if(k==="video"&&!b.type.startsWith("video/")){alert(t("admin.team.invalidVideoFile"));return}x.debug("Uploading file",{fileName:b.name,fileSize:b.size,fileType:k})}},w=(b,k)=>{x.debug("Adding reaction",{messageId:b,emoji:k}),m(v=>v.map(l=>l.id===b?{...l,reactions:[...l.reactions,{emoji:k,userId:"current-user",timestamp:new Date().toISOString()}]}:l))},C=async(b,k)=>{k.trim()&&(x.debug("Editing message",{messageId:b,newContent:k}),m(v=>v.map(l=>l.id===b?{...l,content:k,isEdited:!0}:l)))},o=async b=>{x.debug("Deleting message",{messageId:b}),m(k=>k.filter(v=>v.id!==b))},j=b=>{x.debug("Bookmarking message",{messageId:b}),m(k=>k.map(v=>v.id===b?{...v,isPinned:!v.isPinned}:v))},N=()=>{var b;(b=f.current)==null||b.scrollIntoView({behavior:"smooth"})};return{loadMessagesForChannel:s,handleSendMessage:g,handleFileUpload:y,handleReaction:w,handleEditMessage:C,handleDeleteMessage:o,handleBookmark:j,scrollToBottom:N}}function na(c){const{setShowSearchModal:t,setShowCreateChannelModal:r,setShowCallModal:a,setShowChannelInfoModal:i,setShowNewDMModal:h,setShowNotifications:m,setShowUserMenu:d,setShowMembersSidebar:u,enabled:p=!0}=c;return n.useEffect(()=>{if(!p){x.debug("[TeamChat] Keyboard shortcuts disabled");return}const f=s=>{if(s.key==="Escape"){x.debug("[TeamChat] Escape key pressed - closing all modals",{timestamp:new Date().toISOString()}),t(!1),r(!1),a(null),i(!1),h(!1),m(!1),d(!1),u(!1),s.preventDefault();return}if((s.metaKey||s.ctrlKey)&&s.key==="k"){x.debug("[TeamChat] Search shortcut triggered",{timestamp:new Date().toISOString()}),t(!0),s.preventDefault();return}};return window.addEventListener("keydown",f,{passive:!1}),x.debug("[TeamChat] Keyboard shortcuts initialized",{enabled:p,supportedKeys:["Escape","Cmd/Ctrl+K"]}),()=>{window.removeEventListener("keydown",f),x.debug("[TeamChat] Keyboard shortcuts cleaned up")}},[p,t,r,a,i,h,m,d,u]),null}function ia(c){const{showCallModal:t,callStatus:r,setCallStatus:a,setCallDuration:i,setIsMicMuted:h,setIsVideoOff:m,setIsSpeakerMuted:d,onMount:u}=c;return n.useEffect(()=>(x.info("[TeamChat] Component mounted - loading initial data",{timestamp:new Date().toISOString()}),u&&u(),()=>{x.debug("[TeamChat] Component unmounting")}),[]),n.useEffect(()=>{if(t&&r==="connected"){x.debug("[TeamChat] Starting call timer",{callType:t,timestamp:new Date().toISOString()});const p=setInterval(()=>{i(f=>{const s=f+1;return s%60===0&&x.info("[TeamChat] Call duration milestone",{minutes:s/60,callType:t}),s})},1e3);return()=>{clearInterval(p),x.debug("[TeamChat] Call timer stopped")}}},[t,r,i]),n.useEffect(()=>{if(t&&r==="calling"){x.debug("[TeamChat] Call initiated - simulating connection",{callType:t,timeout:3e3});const p=setTimeout(()=>{a("connected"),x.info("[TeamChat] Call connected",{callType:t,timestamp:new Date().toISOString()})},3e3);return()=>{clearTimeout(p),x.debug("[TeamChat] Connection timeout cleared")}}},[t,r,a]),n.useEffect(()=>{t||(x.debug("[TeamChat] Call modal closed - resetting call state",{timestamp:new Date().toISOString()}),a("calling"),i(0),h(!1),m(!1),d(!1))},[t,a,i,h,m,d]),null}function oa(c){var y;const{t}=M("admin"),{user:r,notifications:a,showNotifications:i,showUserMenu:h,setShowNotifications:m,setShowUserMenu:d,setShowSearchModal:u,onNotificationClick:p}=c,f=_e(),s=w=>{m(!1),p&&p(w)},g=()=>{d(!1),confirm(t("teamChat.header.confirmLogout"))&&f((r==null?void 0:r.role)==="agent"?"/agent/login":"/admin/login")};return e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 px-3 sm:px-4 py-2 sm:py-3 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>f(-1),className:"p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("team.header.back"),type:"button",children:e.jsx(Ye,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(L,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 dark:text-purple-400","aria-hidden":"true"}),e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:t("teamChat.header.title")})]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>u(!0),className:"p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("team.header.search"),type:"button",children:e.jsx(T,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>m(!i),className:"relative p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("team.header.notifications"),"aria-expanded":i,type:"button",children:[e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"}),a.filter(w=>w.unread).length>0&&e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full","aria-label":t("teamChat.header.unreadNotifications",{count:a.filter(w=>w.unread).length})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1),"aria-hidden":"true"}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 max-h-96 overflow-y-auto",role:"menu","aria-label":t("teamChat.header.notificationsAria"),children:[e.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t("teamChat.header.notifications")})}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:a.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400 text-sm",children:t("teamChat.header.noNotifications")}):a.map(w=>e.jsxs("button",{onClick:()=>s(w),className:`w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors ${w.unread?"bg-blue-50 dark:bg-blue-900/10":""}`,role:"menuitem",type:"button",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:w.message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:w.time})]},w.id))})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!h),className:"flex items-center gap-1.5 sm:gap-2 p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("team.header.userMenu"),"aria-expanded":h,type:"button",children:[e.jsx("img",{src:((y=r==null?void 0:r.profile)==null?void 0:y.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=user",alt:(r==null?void 0:r.name)||"User",className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full"}),e.jsx(Pe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-400","aria-hidden":"true"})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>d(!1),"aria-hidden":"true"}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 overflow-hidden",role:"menu","aria-label":t("team.header.userMenu"),children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:r==null?void 0:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r==null?void 0:r.email})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{d(!1),f((r==null?void 0:r.role)==="agent"?"/agent/profile":"/admin/settings")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded text-sm text-gray-900 dark:text-gray-100 transition-colors",role:"menuitem",type:"button",children:[e.jsx(Ae,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.header.myProfile")})]}),e.jsxs("button",{onClick:()=>{d(!1),f((r==null?void 0:r.role)==="agent"?"/agent/settings":"/admin/settings")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded text-sm text-gray-900 dark:text-gray-100 transition-colors",role:"menuitem",type:"button",children:[e.jsx(Ue,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.header.settings")})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-600 my-1"}),e.jsxs("button",{onClick:g,className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded text-sm text-red-600 dark:text-red-400 transition-colors",role:"menuitem",type:"button",children:[e.jsx(Le,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("team.chat.logout")})]})]})]})]})]})]})]})})}function da(c){const{t}=M("admin"),{channels:r,selectedChannel:a,searchQuery:i,canManageChannels:h,setSearchQuery:m,setShowCreateChannelModal:d,setShowNewDMModal:u,onChannelSelect:p}=c,f=o=>{if(!i.trim())return o;const j=i.toLowerCase();return o.filter(N=>N.name.toLowerCase().includes(j))},s=f(r.filter(o=>o.type!=="direct")),g=f(r.filter(o=>o.type==="direct")),y=o=>[...o].sort((j,N)=>j.isPinned&&!N.isPinned?-1:!j.isPinned&&N.isPinned?1:j.name.localeCompare(N.name)),w=o=>{var j;return o.type==="direct"?e.jsx("img",{src:((j=o.metadata)==null?void 0:j.avatar)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.id}`,alt:o.name,className:"w-5 h-5 rounded flex-shrink-0"}):o.type==="private"?e.jsx(Xe,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 flex-shrink-0","aria-label":t("teamChat.sidebar.privateChannel")}):e.jsx(aa,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 flex-shrink-0","aria-label":t("teamChat.sidebar.publicChannel")})},C=o=>{const j=(a==null?void 0:a.id)===o.id,N=(o.unreadCount||0)>0;return e.jsxs("button",{onClick:()=>p(o),className:`w-full flex items-center justify-between gap-2 px-2 py-1.5 rounded text-sm mb-1 transition-colors ${j?"bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-700 dark:text-gray-300"}`,"aria-label":`${o.name}${N?`, ${t("teamChat.sidebar.unreadMessages",{count:o.unreadCount})}`:""}`,"aria-current":j?"page":void 0,type:"button",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[w(o),e.jsx("span",{className:`truncate ${N?"font-semibold":""}`,children:o.name})]}),N&&e.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 bg-purple-600 dark:bg-purple-500 text-white text-xs rounded-full min-w-[20px] text-center","aria-label":t("teamChat.sidebar.unread",{count:o.unreadCount}),children:o.unreadCount>99?"99+":o.unreadCount})]},o.id)};return e.jsxs("div",{className:"hidden md:flex md:w-64 lg:w-72 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 flex-col",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold text-gray-900 dark:text-white",children:t("teamChat.sidebar.channels")}),h&&e.jsx("button",{onClick:()=>d(!0),className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":t("teamChat.sidebar.createChannel"),title:t("teamChat.sidebar.createChannelAdmin"),type:"button",children:e.jsx(P,{className:"w-4 h-4 text-gray-600 dark:text-gray-400","aria-hidden":"true"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"text",value:i,onChange:o=>m(o.target.value),placeholder:t("teamChat.sidebar.searchChannels"),className:"w-full pl-8 pr-3 py-1.5 text-sm bg-gray-100 dark:bg-slate-700 border-0 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400","aria-label":t("teamChat.sidebar.searchChannelsAria")})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 mb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:t("teamChat.sidebar.channelsSection")}),s.length>0&&e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:s.length})]}),y(s).map(C),s.length===0&&e.jsx("p",{className:"px-2 py-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:t(i?"teamChat.sidebar.noChannelsFound":"teamChat.sidebar.noChannelsYet")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-2 mb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:t("teamChat.sidebar.directMessages")}),e.jsx("button",{onClick:()=>u(!0),className:"p-0.5 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":t("teamChat.sidebar.newDirectMessage"),type:"button",children:e.jsx(P,{className:"w-3.5 h-3.5 text-gray-500 dark:text-gray-400","aria-hidden":"true"})})]}),y(g).map(C),g.length===0&&e.jsx("p",{className:"px-2 py-4 text-xs text-gray-500 dark:text-gray-400 text-center",children:t(i?"teamChat.sidebar.noUsersFound":"teamChat.sidebar.noDirectMessagesYet")})]})]}),e.jsx("div",{className:"p-3 border-t border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(L,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.sidebar.channelCount",{count:r.length})})]})})]})}function ca(c){const{t}=M("admin"),{messageInput:r,isSending:a,replyingTo:i,showAttachMenu:h,showEmojiPicker:m,showMentionMenu:d,fileInputRef:u,imageInputRef:p,videoInputRef:f,setMessageInput:s,setReplyingTo:g,setShowAttachMenu:y,setShowEmojiPicker:w,setShowMentionMenu:C,onSendMessage:o,onFileUpload:j}=c,N=n.useRef(null);n.useEffect(()=>{const l=N.current;if(!l)return;l.style.height="auto";const S=Math.min(l.scrollHeight,200);l.style.height=`${S}px`},[r]),n.useEffect(()=>{var l;(l=N.current)==null||l.focus()},[]);const b=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),o()),l.key==="@"&&C(!0)},k=(l,S)=>{var E;const I=(E=l.target.files)==null?void 0:E[0];I&&(j(I,S),l.target.value="")},v=!r.trim()||a;return e.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-3 sm:p-4",children:[i&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-100 dark:bg-slate-700 rounded-lg flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-purple-600 dark:text-purple-400",children:t("teamChat.input.replyingTo")}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:t("teamChat.input.user",{userId:i.userId})})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-1",children:i.content})]}),e.jsx("button",{onClick:()=>g(null),className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-600 rounded transition-colors flex-shrink-0","aria-label":t("teamChat.input.cancelReply"),type:"button",children:e.jsx(D,{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>y(!h),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("team.chat.addFile"),"aria-expanded":h,disabled:a,type:"button",children:e.jsx(A,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1),"aria-hidden":"true"}),e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-lg shadow-xl z-20 overflow-hidden",role:"menu","aria-label":t("team.chat.fileOptions"),children:[e.jsxs("button",{onClick:()=>{var l;(l=p.current)==null||l.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[e.jsx(Ze,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.input.image")})]}),e.jsxs("button",{onClick:()=>{var l;(l=f.current)==null||l.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[e.jsx(R,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.input.video")})]}),e.jsxs("button",{onClick:()=>{var l;(l=u.current)==null||l.click(),y(!1)},className:"w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 text-sm text-gray-700 dark:text-gray-300 transition-colors",role:"menuitem",type:"button",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t("teamChat.input.file")})]})]})]})]}),e.jsx("button",{onClick:()=>w(!m),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("teamChat.input.addEmoji"),"aria-expanded":m,disabled:a,type:"button",children:e.jsx(Ge,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})}),e.jsx("button",{onClick:()=>C(!d),className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":t("teamChat.input.mentionUser"),"aria-expanded":d,disabled:a,type:"button",children:e.jsx(Oe,{className:"w-5 h-5 text-gray-600 dark:text-gray-400","aria-hidden":"true"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("textarea",{ref:N,value:r,onChange:l=>s(l.target.value),onKeyDown:b,placeholder:t("teamChat.input.messagePlaceholder"),disabled:a,rows:1,className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none transition-colors","aria-label":t("teamChat.input.typeMessage"),style:{minHeight:"40px",maxHeight:"200px"}})}),e.jsx("button",{onClick:o,disabled:v,className:"p-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 dark:disabled:bg-slate-700 text-white rounded-lg transition-colors flex-shrink-0 disabled:cursor-not-allowed","aria-label":t("teamChat.input.send"),type:"button",children:e.jsx($e,{className:`w-5 h-5 ${a?"animate-pulse":""}`,"aria-hidden":"true"})})]}),r.length>900&&e.jsx("div",{className:"mt-1 text-right",children:e.jsxs("span",{className:`text-xs ${r.length>1e3?"text-red-600 dark:text-red-400 font-semibold":"text-gray-500 dark:text-gray-400"}`,children:[r.length,"/1000"]})}),e.jsx("input",{ref:u,type:"file",accept:"*/*",onChange:l=>k(l,"file"),className:"hidden","aria-hidden":"true"}),e.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:l=>k(l,"image"),className:"hidden","aria-hidden":"true"}),e.jsx("input",{ref:f,type:"file",accept:"video/*",onChange:l=>k(l,"video"),className:"hidden","aria-hidden":"true"})]})}function ha(c){const t=Math.floor(c/60),r=c%60;return`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function ma(c){const{t}=M("admin"),{callType:r,callStatus:a,selectedChannel:i,callDuration:h,isMicMuted:m,isVideoOff:d,isSpeakerMuted:u,setIsMicMuted:p,setIsVideoOff:f,setIsSpeakerMuted:s,setCallStatus:g,setShowCallModal:y}=c,w=()=>{g("ended"),setTimeout(()=>{y(null)},1e3)},C=()=>{switch(a){case"calling":return t("team.modals.call.calling");case"connected":return ha(h);case"ended":return t("team.modals.call.callEnded");default:return""}},o=()=>{switch(a){case"calling":return"bg-blue-500/30 animate-pulse";case"connected":return"bg-green-500/30";case"ended":return"bg-red-500/30";default:return"bg-blue-500/30"}};return e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-purple-900/95 to-blue-900/95 flex items-center justify-center z-50 p-4 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"call-modal-title","aria-describedby":"call-modal-description",children:e.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-3xl p-8 max-w-md w-full border border-white/20 shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`w-28 h-28 mx-auto mb-6 rounded-full flex items-center justify-center relative ${o()}`,children:[r==="voice"?e.jsx(Ve,{className:"w-14 h-14 text-white","aria-hidden":"true"}):e.jsx(R,{className:"w-14 h-14 text-white","aria-hidden":"true"}),a==="connected"&&e.jsx("div",{className:"absolute -bottom-2 -right-2 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center border-4 border-white/10","aria-label":t("team.connected"),children:e.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"})})]}),e.jsx("h3",{id:"call-modal-title",className:"text-2xl font-bold text-white mb-2",children:(i==null?void 0:i.name)||t("teamChat.modals.call.unknown")}),e.jsx("p",{id:"call-modal-description",className:"text-white/70 text-lg mb-8","aria-live":"polite","aria-atomic":"true",children:C()}),a!=="ended"&&e.jsxs("div",{className:"flex gap-4 justify-center mb-6",role:"group","aria-label":t("team.callControls"),children:[e.jsx("button",{onClick:()=>p(!m),className:`p-4 rounded-full transition-all ${m?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"}`,"aria-label":t(m?"team.modals.call.micUnmute":"team.modals.call.micMute"),"aria-pressed":m,type:"button",children:m?e.jsx(Fe,{className:"w-6 h-6 text-white","aria-hidden":"true"}):e.jsx(Qe,{className:"w-6 h-6 text-white","aria-hidden":"true"})}),r==="video"&&e.jsx("button",{onClick:()=>f(!d),className:`p-4 rounded-full transition-all ${d?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"}`,"aria-label":t(d?"team.modals.call.videoOn":"team.modals.call.videoOff"),"aria-pressed":d,type:"button",children:d?e.jsx(sa,{className:"w-6 h-6 text-white","aria-hidden":"true"}):e.jsx(R,{className:"w-6 h-6 text-white","aria-hidden":"true"})}),e.jsx("button",{onClick:()=>s(!u),className:`p-4 rounded-full transition-all ${u?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"}`,"aria-label":t(u?"team.modals.call.speakerUnmute":"team.modals.call.speakerMute"),"aria-pressed":u,type:"button",children:u?e.jsx(ze,{className:"w-6 h-6 text-white","aria-hidden":"true"}):e.jsx(Be,{className:"w-6 h-6 text-white","aria-hidden":"true"})})]}),e.jsxs("button",{onClick:w,className:"w-full px-6 py-4 bg-red-500 hover:bg-red-600 text-white rounded-2xl font-semibold flex items-center justify-center gap-3 transition-all shadow-lg hover:shadow-xl transform hover:scale-105","aria-label":t("team.endCall"),type:"button",children:[e.jsx(He,{className:"w-6 h-6","aria-hidden":"true"}),t("teamChat.modals.call.endCall")]})]})})})}function ua(c){const{t}=M("admin"),{onCreateChannel:r,onClose:a,isSubmitting:i=!1}=c,[h,m]=n.useState(""),[d,u]=n.useState(""),[p,f]=n.useState(!1),[s,g]=n.useState("all"),[y,w]=n.useState([]),[C,o]=n.useState(""),j=n.useRef(null);n.useEffect(()=>{var l;(l=j.current)==null||l.focus()},[]);const N=l=>l.trim()?l.length<3?t("team.modals.createChannel.validation.nameMinLength"):l.length>50?t("team.modals.createChannel.validation.nameMaxLength"):/^[a-zA-Z0-9-_\s]+$/.test(l)?null:t("team.modals.createChannel.validation.nameInvalidChars"):t("team.modals.createChannel.validation.nameRequired"),b=l=>{const S=l.replace(/\s+/g,"-").toLowerCase();m(S),C&&o("")},k=l=>{l.preventDefault();const S=N(h);if(S){o(S),x.warn("[CreateChannelModal] Validation failed",{error:S,channelName:h});return}const I={name:h,description:d.trim(),isPrivate:p,memberSelection:s,selectedMembers:s==="specific"?y:void 0};x.info("[CreateChannelModal] Channel creation requested",{formData:I}),r(I)},v=l=>{l.target===l.currentTarget&&a()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:v,role:"dialog","aria-modal":"true","aria-labelledby":"create-channel-modal-title",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{id:"create-channel-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white",children:t("teamChat.modals.createChannel.title")}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":t("settings.team.channelModal.close"),type:"button",disabled:i,children:e.jsx(D,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"team-channel-name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("teamChat.modals.createChannel.channelName")," ",e.jsx("span",{className:"text-red-500","aria-label":t("settings.team.channelModal.required"),children:"*"})]}),e.jsx("input",{ref:j,id:"team-channel-name",type:"text",value:h,onChange:l=>b(l.target.value),placeholder:t("settings.team.channelModal.channelSlugPlaceholder"),className:`w-full px-3 py-2 border rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors ${C?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-slate-600"}`,"aria-invalid":!!C,"aria-describedby":C?"name-error":"name-help",disabled:i,required:!0}),C?e.jsx("p",{id:"name-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:C}):e.jsx("p",{id:"name-help",className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("teamChat.modals.createChannel.spacesHelp")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"team-channel-description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("team.modals.createChannel.descriptionOptional")}),e.jsx("textarea",{id:"team-channel-description",value:d,onChange:l=>u(l.target.value),placeholder:t("settings.team.channelModal.descriptionPlaceholder"),rows:3,maxLength:200,className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors resize-none","aria-describedby":"description-counter",disabled:i}),e.jsxs("p",{id:"description-counter",className:"mt-1 text-xs text-gray-500 dark:text-gray-400 text-right",children:[d.length,"/200"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",id:"private-channel",checked:p,onChange:l=>f(l.target.checked),className:"mt-0.5 rounded border-gray-300 text-purple-600 focus:ring-purple-500",disabled:i}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"private-channel",className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer",children:t("teamChat.modals.createChannel.makePrivate")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:t("teamChat.modals.createChannel.privateHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("teamChat.modals.createChannel.members")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"member-selection",value:"all",checked:s==="all",onChange:()=>g("all"),className:"text-purple-600 focus:ring-purple-500",disabled:i}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t("teamChat.modals.createChannel.allTeam")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"member-selection",value:"specific",checked:s==="specific",onChange:()=>g("specific"),className:"text-purple-600 focus:ring-purple-500",disabled:i}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t("teamChat.modals.createChannel.specificMembers")})]})]}),s==="specific"&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 dark:bg-slate-900 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("teamChat.modals.createChannel.specificMembersHelp")})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",disabled:i||!h.trim(),className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-purple-500 focus:ring-offset-2",children:i?t("team.modals.createChannel.creating")||"Creating...":t("team.modals.createChannel.create")||"Create"}),e.jsx("button",{type:"button",onClick:a,disabled:i,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t("common:cancel")})]})]})]})})}function ga(c){const{t}=M("admin"),{messageId:r,onConfirm:a,onCancel:i,title:h=t("team.deleteMessage"),description:m=t("team.deleteMessageConfirm"),confirmText:d=t("common.delete"),cancelText:u=t("common.cancel")}=c,p=s=>{s.target===s.currentTarget&&i()},f=()=>{a(r)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:p,role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-sm w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-4","aria-hidden":"true",children:e.jsx(Ke,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h3",{id:"delete-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:h}),e.jsx("p",{id:"delete-modal-description",className:"text-gray-600 dark:text-gray-400 mb-6",children:m}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors font-medium",type:"button",autoFocus:!0,children:u}),e.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium focus:ring-2 focus:ring-red-500 focus:ring-offset-2",type:"button",children:d})]})]})})})}function O(c){try{return Je(c)}catch(t){return x.error("[TeamChat] Error formatting time",t),"--:--"}}function xa(c){return!c||typeof c!="string"?(x.warn("[TeamChat] Invalid avatar seed",new Error(`Invalid seed: ${c}`)),"https://api.dicebear.com/7.x/avataaars/svg?seed=default"):`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(c)}`}function pa(c){const{t}=M("admin"),{messages:r,searchQuery:a,setSearchQuery:i,onClose:h,onMessageClick:m}=c,d=n.useRef(null);n.useEffect(()=>{var s;(s=d.current)==null||s.focus()},[]);const u=a.trim()?r.filter(s=>s.content.toLowerCase().includes(a.toLowerCase())):[],p=s=>{m(s),h()},f=s=>{s.target===s.currentTarget&&h()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:f,role:"dialog","aria-modal":"true","aria-labelledby":"search-modal-title",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-2xl w-full max-h-[80vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[e.jsx("h3",{id:"search-modal-title",className:"text-lg font-bold text-gray-900 dark:text-white",children:t("teamChat.modals.search.title")}),e.jsx("button",{onClick:h,className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-700 rounded transition-colors","aria-label":t("reports.close"),type:"button",children:e.jsx(D,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","aria-hidden":"true"}),e.jsx("input",{ref:d,type:"text",value:a,onChange:s=>i(s.target.value),placeholder:t("team.searchMessages"),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent placeholder:text-gray-500 dark:placeholder:text-gray-400","aria-label":t("team.searchQuery")})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:a.trim()?u.length>0?e.jsx("div",{className:"space-y-2",role:"list","aria-label":t("team.searchResults"),children:u.map(s=>e.jsx("button",{onClick:()=>p(s.id),className:"w-full p-3 text-left hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors",type:"button",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("img",{src:xa(s.userId),alt:t("teamChat.messages.userAvatar"),className:"w-8 h-8 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:t("teamChat.modals.search.user",{userId:s.userId})}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:O(s.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2",children:s.content})]})]})},s.id))}):e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-12",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-2 opacity-50","aria-hidden":"true"}),e.jsx("p",{className:"font-medium",children:t("teamChat.modals.search.noResults")}),e.jsx("p",{className:"text-sm mt-1",children:t("teamChat.modals.search.noResultsFor",{query:a})})]}):e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-12",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-2 opacity-50","aria-hidden":"true"}),e.jsx("p",{className:"font-medium",children:t("teamChat.modals.search.typeToSearch")}),e.jsx("p",{className:"text-sm mt-1",children:t("teamChat.modals.search.searchInContent")})]})}),a.trim()&&u.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-slate-700 flex-shrink-0",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:t("teamChat.modals.search.resultsFound",{count:u.length})})})]})})}const Ea=()=>{const{t:c}=M("admin"),t=We(),{user:r}=qe(),a=ra(),i=la({selectedChannel:a.selectedChannel,messageInput:a.messageInput,isSending:a.isSending,messages:a.messages,replyingTo:a.replyingTo,setMessages:a.setMessages,setMessageInput:a.setMessageInput,setReplyingTo:a.setReplyingTo,setIsSending:a.setIsSending,messagesEndRef:a.refs.messagesEndRef});ia({showCallModal:a.showCallModal,callStatus:a.callStatus,setCallStatus:a.setCallStatus,setCallDuration:a.setCallDuration,setIsMicMuted:a.setIsMicMuted,setIsVideoOff:a.setIsVideoOff,setIsSpeakerMuted:a.setIsSpeakerMuted,onMount:()=>{x.info("[TeamChatPage] Component mounted",{userId:r==null?void 0:r.id,userRole:r==null?void 0:r.role})}}),na({setShowSearchModal:a.setShowSearchModal,setShowCreateChannelModal:a.setShowCreateChannelModal,setShowCallModal:a.setShowCallModal,setShowChannelInfoModal:a.setShowChannelInfoModal,setShowNewDMModal:a.setShowNewDMModal,setShowNotifications:a.setShowNotifications,setShowUserMenu:a.setShowUserMenu,setShowMembersSidebar:a.setShowMembersSidebar,enabled:!0});const m=(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="owner",d=s=>{x.debug("[TeamChatPage] Channel selected",{channelId:s.id}),a.setSelectedChannel(s),i.loadMessagesForChannel(s.id),a.setShowMembersSidebar(!1)},u=s=>{x.info("[TeamChatPage] Creating channel",{formData:s}),alert(c("teamChat.channelCreated",{name:s.name})),a.setShowCreateChannelModal(!1)},p=s=>{if(x.debug("[TeamChatPage] Notification clicked",{notificationId:s.id}),s.channelId){const g=a.channels.find(y=>y.id===s.channelId);g&&d(g)}s.messageId&&setTimeout(()=>{const g=document.getElementById(`message-${s.messageId}`);g&&(g.scrollIntoView({behavior:"smooth",block:"center"}),g.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{g.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3))},300)};n.useEffect(()=>{const s=new URLSearchParams(t.search),g=s.get("channelId"),y=s.get("messageId");if(g&&y){x.debug("[TeamChatPage] Handling mention notification",{channelId:g,messageId:y});const w=a.channels.find(C=>C.id===g);w?(d(w),setTimeout(()=>{const C=document.getElementById(`message-${y}`);C?(C.scrollIntoView({behavior:"smooth",block:"center"}),C.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{C.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3)):x.warn("[TeamChatPage] Message element not found",{messageId:y})},500)):x.warn("[TeamChatPage] Channel not found",{channelId:g})}},[t.search,a.channels]);const f=s=>{x.debug("[TeamChatPage] Search result clicked",{messageId:s});const g=document.getElementById(`message-${s}`);g&&(g.scrollIntoView({behavior:"smooth",block:"center"}),g.classList.add("bg-yellow-100","dark:bg-yellow-900/30"),setTimeout(()=>{g.classList.remove("bg-yellow-100","dark:bg-yellow-900/30")},2e3))};return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 dark:bg-slate-900",children:[e.jsx(oa,{user:r,notifications:a.notifications,showNotifications:a.showNotifications,showUserMenu:a.showUserMenu,setShowNotifications:a.setShowNotifications,setShowUserMenu:a.setShowUserMenu,setShowSearchModal:a.setShowSearchModal,onNotificationClick:p}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(da,{channels:a.channels,selectedChannel:a.selectedChannel,searchQuery:a.channelSearchQuery,canManageChannels:m,setSearchQuery:a.setChannelSearchQuery,setShowCreateChannelModal:a.setShowCreateChannelModal,setShowNewDMModal:a.setShowNewDMModal,onChannelSelect:d}),e.jsx("div",{className:"flex-1 flex flex-col bg-white dark:bg-slate-800",children:a.selectedChannel?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.messages.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:c("teamChat.messages.noMessages")})}):e.jsxs("div",{className:"space-y-4",children:[a.messages.map(s=>e.jsxs("div",{id:`message-${s.id}`,className:"flex items-start gap-3 transition-colors duration-300",children:[e.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.userId}`,alt:c("teamChat.messages.userAvatar"),className:"w-10 h-10 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:c("teamChat.messages.user",{userId:s.userId})}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:O(s.timestamp)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words",children:s.content})]})]},s.id)),e.jsx("div",{ref:a.refs.messagesEndRef})]})}),e.jsx(ca,{messageInput:a.messageInput,isSending:a.isSending,replyingTo:a.replyingTo,showAttachMenu:a.showAttachMenu,showEmojiPicker:a.showEmojiPicker,showMentionMenu:a.showMentionMenu,fileInputRef:a.refs.fileInputRef,imageInputRef:a.refs.imageInputRef,videoInputRef:a.refs.videoInputRef,setMessageInput:a.setMessageInput,setReplyingTo:a.setReplyingTo,setShowAttachMenu:a.setShowAttachMenu,setShowEmojiPicker:a.setShowEmojiPicker,setShowMentionMenu:a.setShowMentionMenu,onSendMessage:i.handleSendMessage,onFileUpload:i.handleFileUpload})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:c("teamChat.selectChannel")}),e.jsx("p",{className:"text-sm",children:c("teamChat.selectChannelDescription")})]})})})]}),a.showCallModal&&e.jsx(ma,{callType:a.showCallModal,callStatus:a.callStatus,selectedChannel:a.selectedChannel,callDuration:a.callDuration,isMicMuted:a.isMicMuted,isVideoOff:a.isVideoOff,isSpeakerMuted:a.isSpeakerMuted,setIsMicMuted:a.setIsMicMuted,setIsVideoOff:a.setIsVideoOff,setIsSpeakerMuted:a.setIsSpeakerMuted,setCallStatus:a.setCallStatus,setShowCallModal:a.setShowCallModal}),a.showCreateChannelModal&&e.jsx(ua,{onCreateChannel:u,onClose:()=>a.setShowCreateChannelModal(!1),isSubmitting:!1}),a.showDeleteConfirm&&e.jsx(ga,{messageId:a.showDeleteConfirm,onConfirm:i.handleDeleteMessage,onCancel:()=>a.setShowDeleteConfirm(null)}),a.showSearchModal&&e.jsx(pa,{messages:a.messages,searchQuery:a.messageSearchQuery,setSearchQuery:a.setMessageSearchQuery,onClose:()=>{a.setShowSearchModal(!1),a.setMessageSearchQuery("")},onMessageClick:f})]})};export{Ea as default};
//# sourceMappingURL=TeamChatPage-BHoUZopV.js.map
